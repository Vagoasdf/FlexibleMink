#!/usr/bin/env bash

set -eu

ROOT="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

echo "Installing Composer..."
"$ROOT"/bin/init/install_composer.sh

if [[ "${CI:-}" == "true" ]]; then
    echo "Configuring Composer Github OAuth..."
    composer config -g github-oauth.github.com "$GITHUB_OAUTH"

    echo "Initializing git hooks..."
    "$ROOT"/bin/init_git_hooks

    echo "Initializing submodules..."
    git submodule update --init
fi

echo "Installing Composer dependencies..."
composer install --no-interaction
